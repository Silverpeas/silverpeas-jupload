<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.3 at Jan 15, 2014 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>JUpload project on Sourceforge - JUpload - File Upload Applet - HowTo sign the applet ?</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20140115" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                JUpload project on Sourceforge
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
            
                <div class="xleft">
        <span id="publishDate">Last Published: 2014-01-15</span>
                  &nbsp;| <span id="projectVersion">Version: 5.1.0</span>
                      </div>
            <div class="xright">                    <a href="http://sourceforge.net/projects/jupload/" class="externalLink" title="Sourceforge project page">Sourceforge project page</a>
            |
                              <a href="http://sourceforge.net/donate/index.php?group_id=59144" class="externalLink" title="Support this project">                                                      <img class="imageLink" src="http://images.sourceforge.net/images/project-support.jpg" alt=""/>
  Support this project</a>
                |
                        <a href="http://maven.apache.org/" class="externalLink" title="Maven">Maven</a>
              
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
            
                                <h5>Sourceforge project page</h5>
                  <ul>
                  <li class="none">
                          <a href="http://sourceforge.net/projects/jupload/" class="externalLink" title="Project presentation (and download)">Project presentation (and download)</a>
            </li>
                  <li class="none">
                          <a href="http://sourceforge.net/projects/jupload/files" class="externalLink" title="Browse files">Browse files</a>
            </li>
          </ul>
                       <h5>JUpload samples</h5>
                  <ul>
                  <li class="none">
                          <a href="applet-basic.html" title="Basic demo">Basic demo</a>
            </li>
                  <li class="none">
                          <a href="applet-basic-picture.html" title="Picture mode demo">Picture mode demo</a>
            </li>
                  <li class="none">
                          <a href="advanced_js_demo.html" title="Advanced demo">Advanced demo</a>
            </li>
          </ul>
                       <h5>General documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="General description">General description</a>
            </li>
                  <li class="none">
                          <a href="faq.html" title="FAQ">FAQ</a>
            </li>
                  <li class="none">
                          <a href="README.txt" title="Release Notes">Release Notes</a>
            </li>
                  <li class="none">
                          <a href="howto-use.html" title="HowTo use/test the applet">HowTo use/test the applet</a>
            </li>
                  <li class="none">
                          <a href="howto-debug.html" title="HowTo debug">HowTo debug</a>
            </li>
                  <li class="none">
                          <a href="howto-support.html" title="HowTo get support">HowTo get support</a>
            </li>
          </ul>
                       <h5>Technical documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="howto-compile.html" title="HowTo compile">HowTo compile</a>
            </li>
                  <li class="none">
            <strong>HowTo sign the applet</strong>
          </li>
                  <li class="none">
                          <a href="howto-customize.html" title="HowTo customize">HowTo customize</a>
            </li>
                  <li class="none">
                          <a href="apidocs/index.html" title="Javadoc">Javadoc</a>
            </li>
                  <li class="none">
                          <a href="apidocs/wjhk/jupload2/upload/package-summary.html" title="How upload works">How upload works</a>
            </li>
          </ul>
                       <h5>Translation</h5>
                  <ul>
                  <li class="none">
                          <a href="howto-translate.html" title="HowTo translate">HowTo translate</a>
            </li>
                  <li class="none">
                          <a href="available_translations.html" title="Available translations">Available translations</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                  <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                                                                                                                               <a href="http://sourceforge.net/donate/index.php?group_id=59144" title="Support this project" class="poweredBy">
        <img class="poweredBy"  alt="Support this project" src="http://images.sourceforge.net/images/project-support.jpg"     />
      </a>
                       
            
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>HowTo sign the applet ?<a name="HowTo_sign_the_applet_"></a></h2><!-- ~~~~~~~~~~~~~~~~~~~~~~ --><ul><li><a href="#HowTo_sign_the_applet_">HowTo sign the applet ?</a><ul><li><a href="#Why_do_you_need_to_sign_the_applet">Why do you need to sign the applet?</a></li><li><a href="#How_to_generate_a_certificate_signed_by_you_own_CA_with_openssl_">How to generate a certificate, signed by you own CA, with openssl ?</a></li><li><a href="#How_to_generate_a_certificate_with_keytool_">How to generate a certificate, with keytool ? </a></li></ul></li></ul><div class="section"><h3><a name="Why_do_you_need_to_sign_the_applet">Why do you need to sign the applet?</a></h3><!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --><p>When running from a web site, within your browser, the applet needs to have access to the local filesystem, in order to choose then upload the files. Thanks to Java protection, this is impossible ... unless specific prerequisite:</p><ul><li>The applet must be signed. Non-signed applet mat never access the local filesystem.</li><li>The user must accept the applet certificate. The user then has the option to accept it for ever, or just for the current session. If the user accepted 'for ever' the certificate, he/she can remove it by doing these actions:<ul><li>Go to the <i>Java Control Panel</i> / Security / Certificates / Approved certificates, and remove the relevant certificate</li><li>Go to the <i>Java Control Panel</i> / General. In the <i>temporary Internet Files</i>, click on the <i>Parameter</i> button. Then, click on the <i>Remove files...</i> button to clean the Java cache.</li></ul></li></ul><p><b>Take care about this:</b> Once a certificate is permanently accepted on a browser, this browser will execute any applet signed by this certificate, without asking the user. So good practices are:</p><ul><li>The keystore and the storepass must remain secret.</li><li>The validity of the certificate must be not too long (1 year seems a maximum to me).</li><li>For commercial use, a good practice is to have a certificate signed by a known <i>Certificate Autority</i>. You'll need to pay, for that...</li></ul></div><div class="section"><h3><a name="How_to_generate_a_certificate_signed_by_you_own_CA_with_openssl_">How to generate a certificate, signed by you own CA, with openssl ?</a></h3><!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --><p>Since Java 1.7 u51, the auto-signed applets may no more run with the 'all-permission' flag, that is, with disk access.</p><p>You need to sign your applet with a certificate, which certificate being signed by an Certificate of Authority known by the local configuration. You can either: create a certificate, and make it be signed by a trusted CA, or create your own CA, and use it to sign the 'base' certificate, you'll sign the applet with.</p><p>This tutorial is based on these pages:</p><ul><li>To create the CA: <a class="externalLink" href="http://www.freebsdmadeeasy.com/tutorials/freebsd/create-a-ca-with-openssl.php">http://www.freebsdmadeeasy.com/tutorials/freebsd/create-a-ca-with-openssl.php</a></li><li>To create the certificate for signing the applet: <a class="externalLink" href="http://www.freebsdmadeeasy.com/tutorials/web-server/apache-ssl-certs.php">http://www.freebsdmadeeasy.com/tutorials/web-server/apache-ssl-certs.php</a></li><li>Some interesting openssl and keytool commands: <a class="externalLink" href="http://shib.kuleuven.be/docs/ssl_commands.shtml">http://shib.kuleuven.be/docs/ssl_commands.shtml</a></li></ul><p>Here are the necessary steps :</p><ul><li>Go to the fodler where you'll create your certificates</li><li>Copy the original openssl.cfg file to ./jupload.cfg</li><li>In the jupload.cfg file:<ul><li>Change the 'dir' value, around line 42 (first line of the CA_default section)</li><li>You may change the 'default_days' value, to another value than 365 (wich stand for one years).</li><li>You can change all default values (parameter ended by '_default'), to avoid typing them for each certificate.</li></ul></li><li>Create these folders:<ul><li>./jupload</li><li>./jupload/certs</li><li>./jupload/private</li><li>./jupload/newcerts</li></ul></li><li>In the ./jupload folder, create these file:<ul><li>echo 1000 &gt; serial (that is, for windows users : a 'serial' file, containing just the '1000' string)</li><li>An empty 'index.txt' file</li><li>For windows only, you'll have to create a 'rnd' file. To have a valid name, I created a 'a.rnd' file, in ./jupload</li></ul></li><li>Back to the . folder</li><li>Create the Certificate Authority. Important: the common name asked when creating this certificate is the name of the 'publisher' of the CA, when it signs other certificate. This name should identify your company (for instance). It may be a different value as the 'Organisation', as asked also by openssl. <div><pre>openssl req -new -x509 -days 3650 -extensions v3_ca -newkey rsa:2048 -keyout jupload/private/cakey.pem -out jupload/cacert.pem -config ./jupload.cfg
</pre></div></li><li>[Useless?] Copy this CA to a format, which can be managed by keytool, the Java keystore management tools:<div><pre>[Useless?]  openssl x509 -outform der -in jupload/cacert.pem -out jupload/cacert.crt 
</pre></div></li><li>Create the jupload Certificate. This certificate will be signed by the CA you juste created. You'll use it to sign the applet. We'll use the keytool java command to create the certificate. You'll be asked for the organization, name (...) for this new certificate.<div><pre>keytool -genkey -keyalg rsa -alias &quot;juploaddemo&quot; -keystore YOUR_KEYSTORE.jks -storepass &quot;secret&quot; -validity 360
</pre></div></li><li>You can check the content of your keystore with this command:<div><pre>keytool -list -keystore YOUR_KEYSTORE.jks -storepass &quot;secret&quot;
</pre></div></li><li>Generate the request to the CA, for certificate signing:<div><pre>keytool -certreq -v -alias &quot;juploaddemo&quot; -file jupload/certs/juploadDemoCARequest.csr -keystore YOUR_KEYSTORE.jks -storepass &quot;secret&quot; 
</pre></div><ul><li>You can now sign the certificate with the CA. With the below command, your certificate will be signed for 1 year.<div><pre>[For windows only] set RANDFILE=./jupload/a.rnd
[Ok for self owned CA] openssl x509 -req -in jupload/certs/juploadDemoCARequest.csr -CA jupload/cacert.pem -CAkey jupload/private/cakey.pem -CAcreateserial -out jupload/newcerts/juploadDemoCARequest.crt -days 365
[Real command, but more checks on certificate attributes] openssl ca -days 365 -in jupload/certs/juploadDemoCARequest.csr -out jupload/newcerts/juploadDemoCARequest.crt
</pre></div></li></ul></li><li>As you do all manually, we have to concatenate the certificate chain:<div><pre>[Windows] copy jupload\newcerts\juploadDemoCARequest.crt + .\jupload\cacert.pem jupload\newcerts\juploadDemoCARequest.chain
[Unix] cat jupload\newcerts\juploadDemoCARequest.crt .\jupload\cacert.pem &gt; jupload\newcerts\juploadDemoCARequest.chain
</pre></div></li><li>Before importing the signed certificate, you must indicate that you trust this CA:<div><pre>keytool -import -trustcacerts -alias juploadca -file jupload/cacert.pem  -keystore YOUR_KEYSTORE.jks -storepass &quot;secret&quot; 
</pre></div></li><li>The chain of certificates is built. You can now import it into your keystore. You should precise an alias (e.g.: -alias juploademo) if you're importing it into another keystore.<div><pre>keytool -import  -alias &quot;juploaddemo&quot; -file jupload\newcerts\juploadDemoCARequest.chain -keystore YOUR_KEYSTORE.jks -storepass &quot;secret&quot;
</pre></div></li></ul></div><div class="section"><h3><a name="How_to_generate_a_certificate_with_keytool_">How to generate a certificate, with keytool ?</a> </h3><!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --><p>With maven compilation, signing the applet is native. See the <a href="./howto-compile.html">HowTo compile the applet</a> page. But you need to create a certificate, in order to sign the applet. Here are the java commands, to create a demo certificate for JUpload:</p><ul><li><b>[IMPORTANT NOTE : THIS PART IS OBSOLETE. IT WON'T WORK WITH JAVA VERSION FROM THE 1.7u51]</b> Generate Private/Public key set (180 days = 6 months) :<div><pre>       keytool -genkey -alias &quot;jupload&quot; -validity 180 -dname &quot;CN=JUpload, OU=Testing/Demo, O=JUpload.SourceForge.net, L=SourceForge, S=SourceForge, C=SG&quot;
</pre></div></li><li>List key set.<div><pre>       keytool -list
</pre></div></li><li>Sign the Applet with the private key. You <b>must do that after each modification of the jar package</b>. You can use the below command, if you want to do this manually, or use the given ant or maven compilation scripts. All details on the <a href="./howto-compile.html">HowTo compile the applet</a> page. The command below allows you to sign the applet with a 'test' certificate: <div><pre>       jarsigner wjhk.jupload.jar jupload
</pre></div></li><li>Verify the jar file have being sign properly.<div><pre>       jarsigner -verify -certs -verbose wjhk.jupload.jar
</pre></div></li></ul><p>You can find more information, to sign the applet is provided by Martin Westin in this thread: <a class="externalLink" href="https://sourceforge.net/forum/forum.php?thread_id=2991519&amp;forum_id=199106">https://sourceforge.net/forum/forum.php?thread_id=2991519&amp;forum_id=199106</a></p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2014.
          All Rights Reserved.      
            
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
